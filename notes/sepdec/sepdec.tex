\documentclass[a4paper, 11pt]{article}
\usepackage[a4paper,left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[bitstream-charter]{mathdesign}
\usepackage{microtype}
\usepackage{textcomp}

\usepackage{mathtools}
\newcommand\SetSymbol[1][]{\nonscript\:#1\vert\allowbreak\nonscript\:\mathopen{}}
\providecommand\given{} % to make it exist
\DeclarePairedDelimiterX\Set[1]\{\}{\renewcommand\given{\SetSymbol[\delimsize]}#1}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=blue,
}
\usepackage{listings}
\usepackage{color}
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}

\lstdefinelanguage{JavaScript}{
  keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, in, while, do, else, case, break, val, then, Inductive, Fixpoint, match, end},
  keywordstyle=\color{blue},
  ndkeywords={class, export, boolean, throw, implements, import, this},
  ndkeywordstyle=\color{darkgray}\bfseries,
  identifierstyle=\color{black},
  sensitive=false,
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  commentstyle=\color{purple}\ttfamily,
  stringstyle=\color{red}\ttfamily
}

\lstset{
   language=JavaScript,
   extendedchars=true,
   basicstyle=\small\ttfamily,
   showstringspaces=false,
   showspaces=false,
   literate=
    {forall}{$\forall$}1
    {->}{$\to$}1
    {=>}{$\implies$}1
    {fun}{$\lambda$}1
}

\usepackage{amsmath}
\usepackage[shortlabels]{enumitem}
\setlength{\parindent}{0mm}
\usepackage{mathpartir}
\newcommand{\mif}{\mathsf{if}\ }
\newcommand{\mthen}{\ \mathsf{then}\ }
\newcommand{\melse}{\ \mathsf{else}\ }



\title{Reducing separation logic with conjunction, disjunction, and star to boolean-quantified linear integer inequalities}
\author{Jules Jacobs}
\begin{document}
\maketitle

We start with an entailment with conjunction, disjunction, and star, for example:
\[
  (P \vee Q) \star (Q \wedge P) \vdash (P \wedge Q) \star (Q \vee P)
\]
The first step is to rewrite conjunction and disjunction in terms of star and universal and existential quantification over $\{0,1\}$, using the following equivalences:

\begin{align*}
P \wedge Q \equiv \forall b \in \{0,1\}, P_b \star Q_{1 - b} \\
P \vee Q \equiv \exists b \in \{0,1\}, P_b \star Q_{1 - b}
\end{align*}
where
\begin{align*}
  P_n := \underbrace{P \star P \star \cdots \star P}_{n \text{ times}}
\end{align*}

For the example we end up with:
\[
  (\exists a, P_a \star Q_{1-a}) \star (\forall b, Q_b \star P_{1-b})
  \vdash
  (\forall c, P_c \star Q_{1-c}) \star (\forall d, Q_d \star P_{1-d})
\]

We pull all the quantifiers to the outermost level, and group the atomic propositions:
\[
  (\exists a, \forall b, P_{a + 1-b} \star Q_{1-a + b})
  \vdash
  (\forall c, \exists d,  P_{c + 1-d} \star Q_{1-c + d})
\]

We bring the quantifiers outside of the entailment:
\[
  \forall a, \exists b,  \forall c, \exists d,
    (P_{a + 1-b} \star Q_{1-a + b}
    \vdash
    P_{c + 1-d} \star Q_{1-c + d})
\]

Finally, we transform the entailment to inequalities (or equalities, for a linear separation logic):
\[
  \forall a, \exists b, \forall c, \exists d,
    a + 1-b \geq c + 1-d \wedge 1-a + b \geq 1-c + d
\]

This is a statement that we could solve with a SMT solver. Note that the inequalities are in fact pseudo-boolean constraints, so we can also use a quantified pseudo boolean solver.\footnote{Whether this is a good way to prove separation logic entailments is another question :) And depends on the solver.}


\end{document}